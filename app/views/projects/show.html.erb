<div class="grid">
  <main class="grid-item 2/3 mobile-1/1">
    <h2 class="section-title"><%= @project.title %></h2>
    <p class="section-description"><%= @project.description %></p>

    <form class="form-stacked grid add-task-form">
      <div class="grid-item 2/3">
        <%= label_tag "title", "Add new task" %>
        <%= text_field_tag "title", nil, placeholder: "New task title..." %>
      </div>

      <div class="grid-item 1/3">
        <%= label_tag "due_date", "Due" %>
        <%= datetime_field_tag "due_date" %>
      </div>

      <div class="grid-item 1/1">
        <div class="form-extra hidden grid">
          <div class="grid-item 1/1">
            <%= label_tag "description", "Description" %>
            <%= text_field_tag "description" %>
          </div>

          <div class="grid-item 1/1">
            <%= submit_tag "Add task", class: "btn-add" %>
            <%= button_tag "Cancel", class: "btn-text btn-cancel" %>
          </div>
        </div>
      </div>
    </form>

    <ul class="tasks-list">
    <% @active_tasks.each do |task| %>
      <li class="task-item">
        <%= check_box_tag task_form_id(task), nil, task.done %>
        <%= label_tag task_form_id(task), task.title, class: "task-title" %>

        <i class="fa fa-caret-down"></i>

        <div class="task-due-date">
          <%= "to #{task.due_date.to_formatted_s(:short)}" %>
        </div>

        <div class="task-extra hidden">
          <p><%= task.description %></p>

          <ul class="list-inline">
            <li>
              <% if task.participants.include?(current_user) %>
                <%= link_to "Leave task",
                  {
                    controller: :user_tasks,
                    action: :leave ,
                    project_id: task.project.id,
                    id: task.id
                  },
                  method: :delete,
                  class: "btn" %>
              <% else %>
                <%= link_to "Join task",
                  {
                    controller: :user_tasks,
                    action: :assign ,
                    project_id: task.project.id,
                    id: task.id
                  },
                  method: :post,
                  class: "btn" %>
              <% end %>
            </li>

            <li>
              <%= link_to "Details",
                  [task.project, task],
                  class: "btn" %>
            </li>

            <li>
              <%= link_to "Edit",
                  [:edit, task.project, task],
                  class: "btn" %>
            </li>

            <li>
              <%= link_to "Remove",
                  [task.project, task],
                  method: :delete,
                  data: { confirm: "Are you sure?" },
                  class: "btn" %>
            </li>
          </ul>
        </div>
      </li>
    <% end %>

      <li class="show-more-item">Show done tasks</li>
    </ul>

    <ul class="tasks-list done-tasks-list hidden">
    <% @done_tasks.each do |task| %>
      <li class="task-item">
        <%= check_box_tag task_form_id(task), nil, task.done %>
        <%= label_tag task_form_id(task), task.title, class: "task-title" %>

        <i class="fa fa-caret-down"></i>

        <div class="task-due-date">
          <%= "to #{task.due_date.to_formatted_s(:short)}" %>
        </div>

        <div class="task-extra hidden">
          <p><%= task.description %></p>

          <ul class="list-divided">
            <li>
              <button class="btn-text">Join task</button>
            </li>
          </ul>
        </div>
      </li>
    <% end %>
    </ul>
  </main>

  <aside class="grid-item 1/3 mobile-1/1">
    <h2 class="section-title">Events</h2>
    <%= link_to new_project_event_path(@project), class: "section-btn" do %>
      <i class="fa fa-plus"></i>
    <% end %>

    <ul class="events-list">
    <% @events.each do |event| %>
      <li class="event-item">
        <h3><%= link_to event.title, project_event_path(@project, event) %></h3>
        <h4><%= event.date.to_formatted_s(:short) %></h4>
      </li>
    <% end %>
    </ul>

    <% if policy(@project).modify? %>
      <h2 class="section-title">Settings</h2>

      <ul class="list-menu">
        <li><%= link_to "Edit project", edit_project_path(@project) %></li>
        <li><%= link_to "Contributors", project_participants_path(@project) %></li>
        <li><%= link_to "Add contributor", link_contributors_project_path(@project) %></li>
      </ul>
    <% end %>
  </aside>
</div>
